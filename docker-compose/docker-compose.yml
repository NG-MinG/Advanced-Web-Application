version: "3"

networks:
  nw-admin:
    driver: bridge
  nw-api-admin:
    driver: bridge
  nw-lecturer:
    driver: bridge
  nw-api-lecturer:
    driver: bridge
  nw-student:
    driver: bridge
  nw-api-student:
    driver: bridge
  nw-redis:
    driver: bridge
  nw-rabbitmq:
    driver: bridge

services:
  nginx:
    build:
      context: ./nginx
    networks:
      - nw-redis
      - nw-rabbitmq
      - nw-admin
      - nw-api-admin
      - nw-lecturer
      - nw-api-lecturer
      - nw-student
      - nw-api-student
    hostname: nginx
    container_name: nginx-reverse-proxy
    ports:
      - "80:80"
    volumes:
      - ./nginx:/etc/nginx
    depends_on:
      - redis
      - rabbitmq
      - api-example

  redis:
    image: redis:alpine
    container_name: redis
    hostname: redis.local
    networks:
      - nw-redis
    ports:
      - "6379:6379"
    command: redis-server --loglevel warning --requirepass "redis123"
    volumes:
      - ./redis/data:/data
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor

  rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: rabbitmq
    hostname: rabbitmq.local
    networks:
      - nw-rabbitmq
    ports:
      - "5672:5672"
      - "15672:15672"
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor

  admin-service:
    build:
      context: ../clients/admin
    container_name: admin-service
    hostname: awa-classroom-admin.local
    networks:
      - nw-admin
      - nw-rabbitmq
      - nw-redis
    ports:
      - "3002:3002"
    volumes:
      - ../clients/admin:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor
    depends_on:
      - redis
      - rabbitmq

  admin-api-service:
    build:
      context: ../servers/admin
    container_name: admin-api-service
    hostname: awa-classroom-admin-api.local
    networks:
      - nw-api-admin
      - nw-rabbitmq
      - nw-redis
    ports:
      - "5002:5002"
    volumes:
      - ../servers/admin:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor
    depends_on:
      - redis
      - rabbitmq

  lecturer-service:
    build:
      context: ../clients/lecturer
    container_name: lecturer-service
    hostname: awa-classroom-lecturer.local
    networks:
      - nw-lecturer
      - nw-rabbitmq
      - nw-redis
    ports:
      - "3001:3001"
    volumes:
      - ../clients/lecturer:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor
    depends_on:
      - redis
      - rabbitmq

  lecturer-api-service:
    build:
      context: ../servers/lecturer
    container_name: lecturer-api-service
    hostname: awa-classroom-lecturer-api.local
    networks:
      - nw-api-lecturer
      - nw-rabbitmq
      - nw-redis
    ports:
      - "5001:5001"
    volumes:
      - ../servers/lecturer:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor
    depends_on:
      - redis
      - rabbitmq

  student-service:
    build:
      context: ../clients/student
    container_name: student-service
    hostname: awa-classroom-student.local
    networks:
      - nw-student
      - nw-rabbitmq
      - nw-redis
    ports:
      - "3000:3000"
    volumes:
      - ../clients/student:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor
    depends_on:
      - redis
      - rabbitmq

  student-api-service:
    build:
      context: ../servers/sutdent
    container_name: student-api-service
    hostname: awa-classroom-student-api.local
    networks:
      - nw-api-student
      - nw-rabbitmq
      - nw-redis
    ports:
      - "5000:5000"
    volumes:
      - ../servers/student:/usr/src/app
    environment:
      FORCE_COLOR: 1
      DEBUG_COLORS: "true"
      TERM: xterm-256color
      COLORTERM: truecolor
    depends_on:
      - redis
      - rabbitmq

  # zookeeper:
  #   image: 'zookeeper'
  #   restart: always
  #   hostname: zookeeper
  #   container_name: kabgo-zookeeper
  #   ports:
  #     - 2181:2181
  #   environment:
  #     - ALLOW_ANONYMOUS_LOGIN=yes
  #     - FORCE_COLOR=1
  #     - DEBUG_COLORS="true"
  #     - TERM=xterm-256color
  #     - COLORTERM=truecolor

  # kafka:
  #   image: 'bitnami/kafka'
  #   hostname: kafka.kabgo.local
  #   container_name: kabgo-kafka
  #   ports:
  #     - '9092:9092'
  #   environment:
  #     - KAFKA_CFG_BROKER_ID=1
  #     - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181
  #     - KAFKA_CFG_LISTENERS=PLAINTEXT://localhost:9092
  #     - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9092
  #     - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=PLAINTEXT:PLAINTEXT
  #     - ALLOW_PLAINTEXT_LISTENER=yes
  #     - KAFKA_CFG_ALLOW_EVERYONE_IF_NO_ACL_FOUND=true
  #     - FORCE_COLOR=1
  #     - DEBUG_COLORS="true"
  #     - TERM=xterm-256color
  #     - COLORTERM=truecolor
  #   depends_on:
  #     - zookeeper
